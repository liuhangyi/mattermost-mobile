name: test
description: Common tests for mobile repo

runs:
  using: composite
  steps:
    - name: ci/prepare-node-deps
      uses: ./.github/actions/prepare-node-deps

    - name: ci/check-styles
      shell: bash
      run: |
        echo "::group::check-styles"
        npm run check
        echo "::endgroup::"
    - name: ci/run-tests
      shell: bash
      run: |
        echo "::group::run-tests"
        npm run test:coverage
        echo "::endgroup::"

    - name: ci/download-current-coverage
      uses: actions/download-artifact@c850b930e6ba138125429b7e5c93fc707a7f8427 # v4.1.4
      with:
        name: test-coverage-result
        path: current-coverage/coverage-summary.json
        token: ${{ secrets.MM_MOBILE_GITHUB_TOKEN }}

    - name: ci/read-coverage
      shell: bash
      run: |
        echo "::group::read-coverage"
        ./scripts/read-coverage.sh ./current-coverage/coverage-summary.json
        echo "::endgroup::"

    - name: ci/upload-coverage
      uses: actions/upload-artifact@65c4c4a1ddee5b72f698fdd19549f0f0fb45cf08 # v4.6.0
      with:
        name: test-coverage-result
        path: coverage/coverage-summary.json
        overwrite: true

    - name: ci/check-i18n
      shell: bash
      run: |
        echo "::group::check-i18n"
        ./scripts/precommit/i18n.sh
        echo "::endgroup::"
